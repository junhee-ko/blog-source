---
layout: post
title: "B-Tree Index #1 - 구조" 
date: 2023-07-30
categories: MySQL
---

B-Tree Index 는 데이터베이스의 인덱싱 알고리즘 가운데 가장 일반적으로 사용되고, 가장 먼저 도입된 알고리즘이다.

## Index

먼저 index 의 개념부터 보자.

DBMS 는 데이터베이스 테이블의 모든 데이터를 검색해서 원하는 결과를 가져오려면 시간이 오래 걸린다.
그래서 컬럼 (또는 칼럼들) 의 값과 해당 레코드가 저장된 주소를 키와 값의 쌍으로 삼아 인덱스를 만들어 두는 것이다.
그리고 인덱스는 저장된 칼럼의 값을 이용해 항상 정렬된 상태를 유지하고, 데이터 파일은 별도의 정렬 없이 그대로 저장된다.

인덱스가 많은 테이블은 insert, update, delete 문장의 처리가 느려진다.
하지만, 이미 정렬된 인덱스를 가지고 있기 때문에, select 문장의 처리가 빠르다.

## B-Tree Index 구조 및 특성

최상단에 하나의 root node 가 존재하고, 그 하위에 자식 노드가 붙어 있는 형태이다.
트리 구조의 가장 하단에 있는 노드를 leaf node, root node 도 아니고 leaf node 도 아닌 중간에 있는 노드를 branch node 라고 한다.
리프 노드는 항상 실제 데이터의 레코드를 찾아가기 위한 주솟값을 가지고 있다.
인덱스는 테이블의 키 칼럼만 가지고 있으므로, 나머지 칼럼을 읽으려면 데이터 파일에서 해당 레코드를 찾아야한다.

## 인덱스 키 추가 및 삭제

인덱스 키에 대한 다음 작업들에 대해 정리한다.

1. 추가
2. 삭제
3. 변경
4. 검색

### 인덱스 키 추가

B-Tree 에 저장될 때는, 

1. 저장될 키 값을 이용해 B-Tree 상의 적절한 위치를 검색한 뒤에,
2. 저장될 위치가 결정되면 레코드의 키 값과 대상 레코드의 주소 정보를 B-Tree 리프 노드에 저장해야한다.

리프 노드가 꽉 차서 더 저장할 수 없으면 리포 노드가 분리되어야 하는데, 이는 상위 브랜치 노드까지 처리 범위가 넓어진다.
그래서, B-Tree 는 쓰기 작업에 비용이 많이 든다.

### 인덱스 키 삭제

B-Tree 의 키 값이 삭제되는 경우는, 해당 키 값이 저장된 B-Tree 의 리프 노드를 찾아 삭제 마크만 하면 완료된다.
삭제 마킹된 인덱스의 키 공간은 그대로 방치하거나 재활용할 수 있다.

### 인덱스 키 변경

B-Tree 의 키 값 변경 작업은 먼저 키 값을 삭제한 후에, 다시 새로운 키 값을 추가하는 형태로 처리된다.

### 인덱스 키 검색

인덱스를 검색하는 작업은 루트 노드부터 시작해서 브랜치 노드를 거쳐 최종 리프 노드까지 이동하면서 비교 작업을 수행한다.

---

Real MySQL 8.0 <백은빈, 이성욱>
